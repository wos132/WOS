<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Aplikacje</title>
  <link rel="stylesheet" href="style.css">
  <script src="auth.js"></script>
</head>

<body onload="checkAuth(); loadApps();">

  <h2>Dostępne aplikacje</h2>

  <div id="appList" class="menu"></div>

  <p id="error" style="color:red;"></p>

  <a href="dashboard.html">Powrót</a>

<script>
// ===== AUTOMATYCZNE WYLOGOWANIE PO 60s BEZCZYNNOŚCI =====
const TIMEOUT_SECONDS = 60;
let timeoutTimer;

function resetTimer() {
  clearTimeout(timeoutTimer);
  timeoutTimer = setTimeout(() => {
    window.location.href = "index.html";
  }, TIMEOUT_SECONDS * 1000);
}

// Start + nasłuchiwanie aktywności
window.addEventListener('load', () => {
  resetTimer();
  ['mousemove','mousedown','keypress','scroll','touchstart','click','keydown'].forEach(evt => {
    document.addEventListener(evt, resetTimer, { passive: true });
  });
});

// ===== ŁADOWANIE APLIKACJI Z apps.json =====
async function loadApps() {
  try {
    const res = await fetch("apps.json");
    
    // Jeśli serwer zwróci 404 lub inny błąd
    if (!res.ok) throw new Error(`Błąd ${res.status}: nie można wczytano apps.json`);

    const apps = await res.json();
    const list = document.getElementById("appList");

    // Wyczyść poprzednią zawartość
    list.innerHTML = "";

    if (apps.length === 0) {
      list.innerHTML = "<p style='color: orange;'>Brak aplikacji w pliku apps.json</p>";
      return;
    }

    apps.forEach(app => {
      const btn = document.createElement("button");
      btn.innerText = app.name || "Brak nazwy";
      btn.onclick = () => askPin(app.pin, app.page);
      list.appendChild(btn);
      const br = document.createElement("br");
      list.appendChild(br);
    });

  } catch (err) {
    console.error(err);
    document.getElementById("error").innerText = 
      "Nie można wczytać apps.json – sprawdź konsolę (F12)";
  }
}

function askPin(correctPin, page) {
  const pin = prompt("Podaj PIN do tej aplikacji:");
  if (pin === correctPin) {
    // OTWIERA ZAWSZE W NOWEJ KARCIE
    window.open(page, '_blank', 'noopener,noreferrer');
  } else if (pin !== null) {
    alert("Błędny PIN!");
  }
}

// Uruchom po załadowaniu strony
window.addEventListener('load', loadApps);
</script>


</body>
</html>






